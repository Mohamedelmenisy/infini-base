/* ========== الخطوط والألوان العامة (Design Tokens) ========== */
:root {
  --bg-main: #0b1220;
  --bg-content: #0f1724;
  --bg-quick-review: #0d1320;
  --bg-level-box: #1e2d42;
  --text-main: #e6eef8;
  --text-secondary: #9ca3af;
  --color-link: #c7d2fe;
  --color-pill: #6d28d9;
  --color-highlight: #93c5fd;
  --border-color: #1e293b;
  --font-family: 'Cairo', 'Inter', 'Segoe UI', Tahoma, Arial, sans-serif;
}

.kb-app {
  font-family: var(--font-family);
  background-color: var(--bg-main);
  color: var(--text-main);
  padding: 0;
  margin: 0;
  width: 100%;
  box-sizing: border-box;
}

/* Centered and constrained content container */
.kb-container {
  max-width: 1100px;
  padding: 1.5rem;
  margin: 0 auto;
  box-sizing: border-box;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.fade-in { animation: fadeInUp 0.6s ease-out forwards; }

/* ========== Banner and Language Toggle ========== */
.header-banner {
  width: 100%;
  padding: 1rem 0;
  margin-bottom: 1.5rem;
  box-sizing: border-box;
}
.header-banner img {
  width: 220px;
  height: auto;
  margin: 0 auto;
  display: block;
  border-radius: 8px;
}
.language-toggle-wrapper {
  margin: 0 auto 1.5rem auto;
  padding: 0 1.5rem;
  text-align: center;
}
#lang-toggle-button {
  display: inline-block;
  cursor: pointer;
  padding: 0.6rem 1.5rem;
  font-weight: 600;
  border-radius: 9999px;
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: #fff !important;
  border: none;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
  transition: all 0.3s;
  font-size: 0.9rem;
}
#lang-toggle-button:hover {
  transform: translateY(-2px);
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  box-shadow: 0 5px 12px rgba(0,0,0,0.3);
}

/* ========== Typography ========== */
.kb-app h1 { display: none; }
.kb-app h2 {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--color-highlight);
  margin: 2rem 0 1rem 0;
  padding: 0.5rem 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}
.kb-app h3 {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--text-main);
  margin: 1.5rem 0 1rem 0;
  padding: 0.5rem 0;
  border-right: 3px solid var(--color-pill);
  padding-right: 10px;
}
.level-heading-box {
  background-color: var(--bg-level-box);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 1rem;
  margin: 2rem 0 1.5rem 0;
}
.level-heading-box h3 {
  margin: 0;
  padding: 0;
  border: none;
  font-size: 1.15rem;
  color: var(--color-highlight);
}
.kb-app[dir="rtl"] .level-heading-box h3 {
  border-right: 3px solid var(--color-highlight);
  padding-right: 10px;
}
.kb-app[dir="ltr"] .level-heading-box h3 {
  border-left: 3px solid var(--color-highlight);
  padding-left: 10px;
}

.kb-app p, .kb-app li {
  font-size: 1.05rem;
  line-height: 1.8;
  color: var(--text-main);
  font-weight: 500; /* Increased font weight */
  margin: 0 0 1rem 0;
}
.kb-app .note {
  font-size: 0.95rem;
  color: var(--text-secondary);
  font-style: italic;
  display: block;
  margin-top: 1rem;
  padding: 1rem;
  border-radius: 6px;
  background-color: rgba(156, 163, 175, 0.05);
  border-right: 4px solid var(--color-link);
}
.kb-app a {
  color: var(--color-link);
  text-decoration: none;
  transition: color 0.3s;
}
.kb-app a:hover {
  color: #a5b4fc;
  text-decoration: underline;
}
.kb-link {
  color: #60a5fa;
  text-decoration: underline;
  font-weight: 600;
  transition: 0.2s;
}
.kb-link:hover { color: #93c5fd; }

/* ========== Cards & Lists ========== */
.kb-card {
  background-color: var(--bg-content);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 0 auto 2rem auto;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}
.kb-app ul { list-style-type: none; padding: 0; margin: 1rem 0; }
.kb-card ul li { position: relative; margin-bottom: 0.75rem; }
.ar-content ul li::before {
  content: "•"; color: var(--color-link); font-weight: bold; display: inline-block;
  width: 1em; margin-right: -1em; position: absolute; right: 0; top: 0;
}
.ar-content ul li { padding-right: 1.5rem; }
.en-content ul li::before {
  content: "•"; color: var(--color-link); font-weight: bold; display: inline-block;
  width: 1em; margin-left: -1em; position: absolute; left: 0; top: 0;
}
.en-content ul li { padding-left: 1.5rem; }

/* ========== Quick Overview Box ========== */
.quick-review-box {
  background-color: var(--bg-quick-review);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 12px;
  padding: 1.5rem;
  margin: 0 auto 2rem auto;
}
.quick-review-box h3 { margin-top: 0; padding-top: 0; border-right: 3px solid #f87171; color: #f87171; }
.quick-overview-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
.quick-overview-card {
  background-color: var(--bg-content);
  border: 1px solid var(--border-color);
  border-radius: 10px;
  padding: 1rem;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}
.quick-overview-card h4 { font-size: 1rem; color: var(--color-link); margin: 0 0 0.5rem 0; font-weight: 700; }
.quick-overview-card p { font-size: 0.95rem; line-height: 1.6; margin: 0; color: var(--text-secondary); }

/* ========== Pills & Links ========== */
.pill-link {
  background-color: var(--color-pill);
  color: var(--text-main) !important;
  padding: 0.4rem 1rem;
  border-radius: 25px;
  font-size: 0.85rem;
  font-weight: 600;
  white-space: nowrap;
  transition: background-color 0.3s, transform 0.1s;
}
.pill-link:hover { background-color: #5b21aa; text-decoration: none; }

/* ========== Media & Grids ========== */
.media-preview {
  display: block; position: relative; margin-bottom: 1rem; border-radius: 8px;
  overflow: hidden; border: 1px solid var(--border-color); transition: box-shadow 0.3s;
}
.media-preview:hover { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); }
.media-preview img, .media-preview video { display: block; width: 100%; height: auto; object-fit: cover; }
.media-caption {
  display: block; background-color: rgba(0, 0, 0, 0.6); color: var(--text-main);
  text-align: center; padding: 0.5rem; font-size: 0.85rem; position: absolute;
  bottom: 0; width: 100%; box-sizing: border-box;
}
.grid-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin: 1.5rem 0; }
.grid-item { background-color: rgba(255, 255, 255, 0.03); border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem; }
.grid-item h4 { color: var(--color-highlight); font-size: 1rem; font-weight: 600; margin-top: 0; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border-color); }

/* ========== Lightbox/Modal ========== */
.css-lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; z-index: 1000; }
.css-lightbox.active { display: block; }
.lightbox-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px); }
.lightbox-content {
  position: relative; z-index: 1001; background-color: var(--bg-content); border: 1px solid var(--border-color);
  border-radius: 12px; padding: 20px; margin: 50px auto; width: 90%; max-width: 900px; max-height: 90vh;
  overflow-y: auto; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); animation: zoomIn 0.3s ease-out;
}
@keyframes zoomIn { from { transform: scale(0.9); opacity: 0.5; } to { transform: scale(1); opacity: 1; } }
.lightbox-content img, .lightbox-content video { max-width: 100%; height: auto; display: block; margin: 15px auto; border-radius: 8px; }
.lightbox-content p { color: var(--text-main); }
.lightbox-content h3 { color: var(--color-highlight); border: none; margin: 0 0 1rem 0; }
.lightbox-close { position: absolute; top: 10px; right: 15px; font-size: 30px; font-weight: bold; color: var(--text-secondary); text-decoration: none; transition: color 0.3s; z-index: 1002; }
.lightbox-close:hover { color: var(--color-link); text-decoration: none; }

/* ========== Directional Adjustments ========== */
.kb-app[dir="rtl"] .lightbox-close { right: 15px; left: auto; }
.kb-app[dir="rtl"] .note { border-left: 4px solid var(--color-link); border-right: none; }
.kb-app[dir="ltr"] .lightbox-close { left: 15px; right: auto; }
.kb-app[dir="ltr"] .level-heading-box h3 { border-left: 3px solid var(--color-highlight); padding-left: 10px; border-right: none; padding-right: 0; }
.kb-app[dir="ltr"] .quick-review-box h3 { border-left: 3px solid #f87171; padding-left: 10px; border-right: none; padding-right: 0; }
.kb-app[dir="ltr"] .note { border-left: 4px solid var(--color-link); border-right: none; }

/* ========== Back to Top Button ========== */
.back-to-top { text-align: center; margin: 2rem auto; }
.back-to-top a {
  display: inline-block; background-color: var(--color-pill); color: var(--text-main) !important;
  padding: 0.6rem 1.5rem; border-radius: 9999px; font-weight: 600; text-decoration: none;
  transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.back-to-top a:hover { background-color: #5b21aa; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); text-decoration: none; }

/* ========== NEW/CORRECTED STYLES ========== */
.important-note {
  background: #2a1f1f;
  color: #ffb4b4;
  border-left: 4px solid #ff5757;
  padding: 12px;
  border-radius: 8px;
  margin: 15px 0;
  font-weight: 600;
}
.kb-app[dir="rtl"] .important-note { border-left: none; border-right: 4px solid #ff5757; }

.see-guide { text-align: center; font-weight: 500; color: #c7d2fe; margin: 1.5rem 0; font-size: 1rem; }
.see-guide span { display: inline-block; transform: translateY(2px); margin-left: 5px; }
.kb-app[dir="rtl"] .see-guide span { margin-left: 0; margin-right: 5px; }

.toggle-visual {
  display: block;
  width: 100%;
  text-align: left;
  background-color: #1e293b;
  color: var(--color-link);
  border: 1px solid var(--border-color);
  padding: 0.75rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  margin: 1rem 0 0.5rem 0;
  font-weight: 600;
  transition: background-color 0.2s;
}
.toggle-visual:hover { background-color: #334155; }
.visual-guide { margin-bottom: 1rem; }
.visual-guide img {
  width: 100%;
  border-radius: 8px;
  margin-top: 0.5rem;
  border: 1px solid var(--border-color);
}

.note-ref {
  font-size: 0.9rem;
  font-style: italic;
  color: var(--text-secondary);
  background-color: rgba(30, 41, 59, 0.5);
  padding: 0.5rem 1rem;
  border-radius: 6px;
  margin: 0.5rem 0 1rem 0;
}

.email-box { font-size: 15px; line-height: 1.6; }
busy_new.js (Corrected from busy_new.txt)
The script now includes the necessary JavaScript to power the "Visual guide" toggle buttons.
code
JavaScript
/* busy_new.js
- Robust, works if content inserted after DOM load.
- Lazy loads images and videos for performance.
- Handles lightbox open/close via event delegation.
- Manages language switching (toggle).
- Includes a safe initialization that runs after content is ready.
- NEW: Smooth scrolling for anchor links.
- MODIFIED: Added visual guide toggles.
*/

(function () {
    // ===== Lightbox Functions =====
    window.openLightbox = function (targetId) {
        const lb = document.getElementById(targetId);
        if (!lb) return;
        lb.classList.add('active');
        document.body.style.overflow = 'hidden';
        const video = lb.querySelector('video');
        if (video && typeof video.play === 'function') {
            video.play().catch(() => {}); // Autoplay video in lightbox
        }
    };

    window.closeLightbox = function (targetId) {
        const lb = document.getElementById(targetId);
        if (!lb) return;
        lb.classList.remove('active');
        document.body.style.overflow = '';
        const video = lb.querySelector('video');
        if (video && typeof video.pause === 'function') {
            video.pause(); // Pause video when closing
        }
    };

    // ===== Language Switch Function =====
    function switchLanguage(lang) {
        const arContent = document.getElementById('ar-content');
        const enContent = document.getElementById('en-content');
        const langToggle = document.getElementById('lang-toggle-button');
        const appWrapper = document.querySelector('.kb-app');

        if (!arContent || !enContent || !langToggle || !appWrapper) return;

        if (lang === 'ar') {
            arContent.style.display = 'block';
            enContent.style.display = 'none';
            appWrapper.setAttribute('dir', 'rtl');
            langToggle.textContent = 'Switch to English';
            langToggle.setAttribute('data-lang', 'en');
        } else {
            arContent.style.display = 'none';
            enContent.style.display = 'block';
            appWrapper.setAttribute('dir', 'ltr');
            langToggle.textContent = 'التحويل للعربية';
            langToggle.setAttribute('data-lang', 'ar');
        }
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    window.toggleLanguage = function () {
        const langToggle = document.getElementById('lang-toggle-button');
        if (!langToggle) return;
        const nextLang = langToggle.getAttribute('data-lang') || 'en';
        switchLanguage(nextLang);
    };
    
    // ===== Lazy Loading for Media =====
    function lazyLoadMedia() {
        const lazyMedia = document.querySelectorAll('.kb-app img[data-src], .kb-app video[data-src]');
        if ('IntersectionObserver' in window) {
            const mediaObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const media = entry.target;
                        const src = media.getAttribute('data-src');
                        media.src = src;
                        media.removeAttribute('data-src');
                        if (media.tagName === 'VIDEO') {
                           media.load();
                        }
                        observer.unobserve(media);
                    }
                });
            });
            lazyMedia.forEach(media => mediaObserver.observe(media));
        } else {
            lazyMedia.forEach(media => {
                media.src = media.getAttribute('data-src');
                media.removeAttribute('data-src');
            });
        }
    }

    // ===== Initialization Function =====
    function initBusyNew() {
        // Attach click listener to language toggle button
        const langToggle = document.getElementById('lang-toggle-button');
        if (langToggle && !langToggle._busynew_attached) {
            langToggle.addEventListener('click', (e) => {
                e.preventDefault();
                window.toggleLanguage();
            });
            langToggle._busynew_attached = true;
        }

        // Set initial view to English
        if (document.getElementById('ar-content') && document.getElementById('en-content')) {
            const arStyle = window.getComputedStyle(document.getElementById('ar-content'));
            const enStyle = window.getComputedStyle(document.getElementById('en-content'));
            if (arStyle.display === 'none' && enStyle.display === 'none') {
                 switchLanguage('en');
            }
        }
        
        lazyLoadMedia();
        
        // Attach delegated listeners
        if (!document._busynew_delegated) {
            document.addEventListener('click', function (e) {
                // Lightbox close logic
                const overlay = e.target.closest('.lightbox-overlay');
                if (overlay) {
                    const lb = overlay.closest('.css-lightbox');
                    if (lb && lb.id) { closeLightbox(lb.id); e.preventDefault(); }
                }
                const closeBtn = e.target.closest('.lightbox-close');
                 if (closeBtn) {
                    const lb = closeBtn.closest('.css-lightbox');
                    if (lb && lb.id) { closeLightbox(lb.id); e.preventDefault(); }
                }
                
                // Anchor link smooth scroll logic
                const anchorLink = e.target.closest('a[href^="#"]');
                if (anchorLink) {
                    const href = anchorLink.getAttribute('href');
                    if (href.length > 1) {
                        try {
                            const targetElement = document.getElementById(href.substring(1));
                            if (targetElement) {
                                e.preventDefault();
                                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            }
                        } catch (err) { console.error("Could not scroll to anchor:", err); }
                    }
                }
            }, true);
            document._busynew_delegated = true;
        }

        // NEW: Visual Guide Toggle Buttons
        document.querySelectorAll(".toggle-visual").forEach(btn => {
            btn.addEventListener("click", () => {
                const guide = btn.nextElementSibling;
                if (guide && guide.classList.contains('visual-guide')) {
                    guide.style.display = guide.style.display === "none" ? "block" : "none";
                }
            });
        });
    }

    window.initBusyNew = initBusyNew;

    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(initBusyNew, 0);
    } else {
        document.addEventListener('DOMContentLoaded', initBusyNew);
    }
})();

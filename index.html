<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InfiniBase - Knowledge Base</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f0f0f0;
            color: #333;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 250px;
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            position: fixed;
            height: 100%;
        }
        .sidebar h2 {
            margin: 0 0 20px;
            font-size: 24px;
        }
        .sidebar a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .sidebar a:hover, .sidebar a.active {
            background-color: #3498db;
        }
        .content {
            margin-left: 270px;
            padding: 20px;
            flex-grow: 1;
        }
        .header {
            background-color: #ecf0f1;
            padding: 10px 20px;
            border-bottom: 1px solid #ddd;
        }
        .search-bar {
            margin: 10px 0;
            padding: 10px;
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .card {
            background-color: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            width: 500px;
            max-width: 90%;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .primary-btn {
            background-color: #3498db;
            color: white;
        }
        .secondary-btn {
            background-color: #e74c3c;
            color: white;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h2>InfiniBase</h2>
            <nav id="navigationMenu">
                <div style="font-size: 12px; color: #bdc3c7; margin: 10px 0;">Main</div>
                <a href="#home" data-section="home">Home</a>
                <div style="font-size: 12px; color: #bdc3c7; margin: 10px 0;">Knowledge Areas</div>
                <a href="#support" data-section="support">Support</a>
            </nav>
            <div style="position: absolute; bottom: 20px; width: 200px;">
                <button id="logoutButton" class="secondary-btn">Logout</button>
            </div>
        </aside>

        <div class="content">
            <div class="header">
                <h1 id="currentSectionTitle">Welcome</h1>
                <div id="breadcrumbs">Home</div>
                <input type="text" id="globalSearchInput" class="search-bar" placeholder="Search KB...">
                <div id="searchResultsContainer" style="display: none; background: white; border: 1px solid #ddd; border-radius: 5px; max-height: 300px; overflow-y: auto;"></div>
            </div>

            <main id="pageContentArea">
                <div id="dashboardOverviewContainer" style="display: none;">
                    <div class="card">
                        <h2>Welcome, User!</h2>
                        <p>Here's an overview of your InfiniBase knowledge hub.</p>
                    </div>
                </div>
                <div id="standardSectionContentPlaceholder"></div>
                <div id="itemDetailViewPlaceholder" style="display: none;"></div>
            </main>
        </div>
    </div>

    <div id="addContentModal" class="modal">
        <div class="modal-content">
            <h2>Add New Content</h2>
            <form id="addContentForm">
                <label>Title</label>
                <input type="text" id="contentTitle" required>
                <label>Summary</label>
                <textarea id="contentSummary" rows="3" required></textarea>
                <label>Details</label>
                <textarea id="contentDetails" rows="5"></textarea>
                <div style="text-align: right;">
                    <button type="button" id="cancelAddContentBtn" class="secondary-btn">Cancel</button>
                    <button type="submit" class="primary-btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const kbSystemData = {
            sections: [
                { id: 'home', name: 'Home', description: 'Dashboard and overview.' },
                {
                    id: 'support', name: 'Support', description: 'Support resources.',
                    items: [
                        { id: 'sup_article_001', type: 'article', title: 'Handling High Priority Tickets', summary: 'A guide on managing P1 incidents.', content: 'Detailed content for P1 tickets...' },
                        { id: 'sup_case_001', type: 'case', title: 'User Alpha Frequent Disconnects', summary: 'Investigating network instability.', content: '<p><strong>Step 1:</strong> Check network.</p>' }
                    ]
                }
            ]
        };

        const navigationMenu = document.getElementById('navigationMenu');
        const currentSectionTitle = document.getElementById('currentSectionTitle');
        const breadcrumbs = document.getElementById('breadcrumbs');
        const pageContentArea = document.getElementById('pageContentArea');
        const dashboardOverview = document.getElementById('dashboardOverviewContainer');
        const standardSectionContent = document.getElementById('standardSectionContentPlaceholder');
        const itemDetailView = document.getElementById('itemDetailViewPlaceholder');
        const globalSearchInput = document.getElementById('globalSearchInput');
        const searchResultsContainer = document.getElementById('searchResultsContainer');
        const addContentModal = document.getElementById('addContentModal');
        const addContentForm = document.getElementById('addContentForm');
        const cancelAddContentBtn = document.getElementById('cancelAddContentBtn');

        function escapeHTML(str) { return str.replace(/[&<>"']/g, m => ({ '&': '&', '<': '<', '>': '>', '"': '"', "'": ''' }[m])); }
        function truncateText(text, len) { return text.length <= len ? text : text.substring(0, len) + '...'; }

        function highlightSidebarLink(sectionId) {
            document.querySelectorAll('.sidebar a').forEach(link => link.classList.remove('active'));
            const activeLink = document.querySelector(`.sidebar a[data-section="${sectionId}"]`);
            if (activeLink) activeLink.classList.add('active');
        }

        function displayDashboard() {
            dashboardOverview.style.display = 'block';
            standardSectionContent.style.display = 'none';
            itemDetailView.style.display = 'none';
            currentSectionTitle.textContent = 'Dashboard Overview';
            breadcrumbs.innerHTML = '<span>Home</span>';
        }

        function displaySectionContent(sectionId) {
            dashboardOverview.style.display = 'none';
            standardSectionContent.style.display = 'block';
            itemDetailView.style.display = 'none';

            const sectionData = kbSystemData.sections.find(s => s.id === sectionId);
            if (!sectionData) {
                standardSectionContent.innerHTML = '<div class="card"><h2>Section Not Found</h2></div>';
                currentSectionTitle.textContent = 'Not Found';
                return;
            }

            currentSectionTitle.textContent = sectionData.name;
            breadcrumbs.innerHTML = `<a href="#home">Home</a> > <span>${escapeHTML(sectionData.name)}</span>`;

            let contentHTML = '<div class="card"><button class="primary-btn" onclick="openAddContentModal(\'' + sectionId + '\')">Add New Content</button></div>';
            if (sectionData.items && sectionData.items.length > 0) {
                sectionData.items.forEach(item => {
                    contentHTML += `
                        <div class="card">
                            <h3>${escapeHTML(item.title)}</h3>
                            <p>${escapeHTML(truncateText(item.summary, 120))}</p>
                            <a href="#${sectionId}/${item.id}" class="primary-btn">View Details</a>
                        </div>`;
                });
            } else {
                contentHTML += '<div class="card"><p>No content found in this section.</p></div>';
            }
            standardSectionContent.innerHTML = contentHTML;
        }

        function displayItemDetail(sectionId, itemId) {
            dashboardOverview.style.display = 'none';
            standardSectionContent.style.display = 'none';
            itemDetailView.style.display = 'block';

            const sectionData = kbSystemData.sections.find(s => s.id === sectionId);
            const itemData = sectionData?.items?.find(i => i.id === itemId);

            if (!sectionData || !itemData) {
                itemDetailView.innerHTML = '<div class="card"><p>Error: Item not found.</p></div>';
                return;
            }

            currentSectionTitle.textContent = itemData.title;
            breadcrumbs.innerHTML = `<a href="#home">Home</a> > <a href="#${sectionData.id}">${escapeHTML(sectionData.name)}</a> > <span>${escapeHTML(itemData.title)}</span>`;
            itemDetailView.innerHTML = `
                <div class="card">
                    <h2>${escapeHTML(itemData.title)}</h2>
                    <p>${escapeHTML(itemData.summary)}</p>
                    <hr style="margin: 20px 0;">
                    <div>${itemData.content}</div>
                    <a href="#${sectionId}" class="primary-btn">Back to ${escapeHTML(sectionData.name)}</a>
                </div>`;
        }

        function openAddContentModal(sectionId) {
            addContentForm.dataset.sectionId = sectionId;
            addContentModal.style.display = 'flex';
            document.getElementById('contentTitle').focus();
        }

        function closeAddContentModal() {
            addContentModal.style.display = 'none';
            addContentForm.reset();
        }

        addContentForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const sectionId = addContentForm.dataset.sectionId;
            const section = kbSystemData.sections.find(s => s.id === sectionId);
            if (!section) return;

            const newItem = {
                id: `${sectionId}_item_${Date.now()}`,
                type: 'article',
                title: document.getElementById('contentTitle').value,
                summary: document.getElementById('contentSummary').value,
                content: document.getElementById('contentDetails').value.replace(/\n/g, '<br>')
            };

            if (!section.items) section.items = [];
            section.items.push(newItem);
            closeAddContentModal();
            if (window.location.hash.substring(1) === sectionId) displaySectionContent(sectionId);
        });

        cancelAddContentBtn.addEventListener('click', closeAddContentModal);

        globalSearchInput.addEventListener('input', () => {
            const query = globalSearchInput.value.trim().toLowerCase();
            if (query.length < 2) {
                searchResultsContainer.style.display = 'none';
                return;
            }
            const results = [];
            kbSystemData.sections.forEach(s => {
                s.items?.forEach(i => {
                    if (i.title.toLowerCase().includes(query) || i.summary?.toLowerCase().includes(query)) {
                        results.push({ ...i, sectionId: s.id, sectionName: s.name });
                    }
                });
            });
            searchResultsContainer.innerHTML = '';
            if (results.length) {
                results.slice(0, 5).forEach(r => {
                    const li = document.createElement('a');
                    li.href = `#${r.sectionId}/${r.id}`;
                    li.style.display = 'block';
                    li.style.padding = '10px';
                    li.style.borderBottom = '1px solid #ddd';
                    li.innerHTML = `<strong>${escapeHTML(r.title)}</strong> (${r.sectionName})<br>${escapeHTML(truncateText(r.summary, 50))}`;
                    li.addEventListener('click', () => { searchResultsContainer.style.display = 'none'; globalSearchInput.value = ''; });
                    searchResultsContainer.appendChild(li);
                });
                searchResultsContainer.style.display = 'block';
            } else {
                searchResultsContainer.innerHTML = '<div style="padding: 10px;">No results found.</div>';
                searchResultsContainer.style.display = 'block';
            }
        });

        document.addEventListener('click', e => {
            if (!globalSearchInput.contains(e.target) && !searchResultsContainer.contains(e.target)) {
                searchResultsContainer.style.display = 'none';
            }
        });

        function handleNavigation() {
            const hash = window.location.hash.substring(1) || 'home';
            const [sectionId, itemId] = hash.split('/');

            highlightSidebarLink(sectionId);

            if (sectionId === 'home') {
                displayDashboard();
            } else if (itemId && sectionId) {
                displayItemDetail(sectionId, itemId);
            } else if (sectionId) {
                displaySectionContent(sectionId);
            } else {
                displayDashboard();
            }
        }

        document.getElementById('logoutButton').addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.clear();
                window.location.reload();
            }
        });

        window.addEventListener('hashchange', handleNavigation);
        handleNavigation();
    </script>
</body>
</html>

<!DOCTYPE html>
<html class="dark" data-hash="2025-06-24T15:30" dir="ltr" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>InfiniBase - Polished Dashboard</title>
<!-- Cairo Font for Arabic -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<!-- Favicon -->
<link href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' width='32' height='32'&gt;&lt;rect width='32' height='32' rx='4' fill='%236366f1'/&gt;&lt;text x='50%' y='55%' dominant-baseline='middle' text-anchor='middle' font-family='Arial, sans-serif' font-size='18' font-weight='bold' fill='white'&gt;IB&lt;/text&gt;&lt;/svg&gt;" rel="icon" type="image/svg+xml"/>
<!-- CDNs -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"/>
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<!-- Spotlight.js for Lightbox Effect -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spotlight.js/dist/css/spotlight.min.css" />
<script src="https://cdn.jsdelivr.net/npm/spotlight.js/dist/js/spotlight.min.js" defer></script>
<!-- Diff2HTML for Version History -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>

<style>
    /* ========== متغيرات التصميم ========== */
    :root {
        /* Permanent Dark Theme Variables */
        --primary-color: #6366f1; /* Brighter Indigo for dark */
        --primary-color-hover: #4f46e5;
        --secondary-color: #9ca3af;

        --text-color: #d1d5db;
        --text-color-muted: #9ca3af;
        --text-color-inverted: #ffffff;
        --text-color-subtle: #9ca3af;

        --bg-color: #111827; /* Dark gray */
        --bg-color-alt: #1f2937; /* Slightly lighter dark gray for cards/modals */
        --bg-color-sidebar: #1f2937;
        --bg-color-header: rgba(31, 41, 55, 0.9);
        --bg-color-modal: #1f2937;
        --bg-color-hover: #374151;
        --bg-color-active: var(--primary-color);

        --border-color: #374151;
        --border-color-darker: #4b5563;

        --card-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        --card-hover-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        
        --border-radius: 0.5rem;
        --border-radius-lg: 0.75rem;
        --header-height: 70px;
        --sidebar-width: 260px;

        --yes-color: #22c55e; /* Green for Yes */
        --no-color: #ef4444;   /* Red for No */
        --rating-color: #fbbf24; /* Amber 400 for ratings */
    }

    /* ========== شاشة التحميل ========== */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: var(--bg-color);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
    }

    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid var(--border-color);
        border-top: 5px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }

    .loading-text {
        color: var(--text-color);
        font-size: 1.1rem;
        font-weight: 500;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .hidden {
        display: none !important;
    }

    /* ========== أنماط CSS الأساسية ========== */
    /* (جميع الأنماط الحالية محفوظة هنا) */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        line-height: 1.6;
        font-size: 16px;
    }

    /* --- HIDE SCROLLBARS --- */
    .sidebar, .content-wrapper, #recentActivity {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }
    .sidebar::-webkit-scrollbar, .content-wrapper::-webkit-scrollbar, #recentActivity::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
    }

    a { text-decoration-skip-ink: none; }
    
    [lang='ar'] {
        font-family: 'Cairo', sans-serif;
        direction: rtl;
    }

    .container-fluid {
        display: flex;
        min-height: 100vh;
    }

    .sidebar {
        width: var(--sidebar-width);
        background-color: var(--bg-color-sidebar);
        padding: 1.5rem;
        border-right: 1px solid var(--border-color); /* LTR */
        position: fixed;
        top: 0;
        left: 0; /* LTR */
        height: 100vh;
        overflow-y: auto;
        transition: transform 0.3s ease-in-out, background-color: 0.3s ease, border-color: 0.3s ease;
        z-index: 100;
        display: flex;
        flex-direction: column;
    }
    .sidebar.closed {
        transform: translateX(-100%); /* LTR */
    }
    @media (min-width: 768px) {
        .sidebar.closed { transform: translateX(0); }
    }

    .sidebar-header {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        color: #F9FAFB;
        padding-left: 0.5rem;
    }
    .sidebar-header img {
        height: 36px;
        width: auto;
        border-radius: 6px;
        margin-right: 12px;
    }
    .sidebar-logo-text {
         color: var(--text-color);
    }

    .sidebar-nav { flex-grow: 1; }

    .sidebar-section-title {
        padding-left: 0.75rem; /* LTR */
        font-size: 0.75rem;
        font-weight: 700; /* Increased font-weight for better visibility */
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        color: var(--text-color-muted);
    }

    .sidebar-link {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        border-radius: var(--border-radius);
        transition: background-color: 0.2s ease, color: 0.2s ease;
        font-weight: 500;
        color: var(--text-color-subtle);
        text-decoration: none;
        margin-bottom: 0.25rem;
    }
    .sidebar-link i {
        margin-right: 0.75rem; /* LTR */
        width: 1.5rem; /* Adjusted for font-size */
        font-size: 1.5rem; /* Increased icon size */
        text-align: center;
        transition: color 0.2s ease;
    }
    .sidebar-link:hover {
        background-color: var(--bg-color-hover);
        color: var(--text-color);
    }
    .sidebar-link.active {
        background-color: var(--bg-color-active); /* Primary color */
        color: var(--text-color-inverted) !important; /* White text */
        font-weight: 600;
    }
    .sidebar-link.active i {
        color: var(--text-color-inverted) !important; /* White icon on primary background */
    }

    .sidebar-footer {
        margin-top: auto;
        padding-top: 1rem;
    }
    .sidebar-footer button {
        width: 100%;
        margin-top: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .sidebar-footer button i { margin-right: 0.5rem; }

    .content-wrapper {
        flex-grow: 1;
        padding-right: 1.5rem; /* LTR */
        padding-left: 1.5rem;
        transition: margin-left 0.3s ease-in-out; /* LTR */
        height: 100vh;
        overflow-y: auto;
    }
    @media (min-width: 768px) {
         .content-wrapper { margin-left: var(--sidebar-width); /* LTR */ }
         .sidebar.closed + .content-wrapper { margin-left: 0; /* LTR */ }
    }

    .content-header {
        background-color: var(--bg-color-header);
        padding: 1.25rem 2rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        left: var(--sidebar-width); /* LTR, adjusted for fixed sidebar */
        right: 0;
        height: var(--header-height);
        z-index: 50;
        backdrop-filter: blur(8px);
    }
     @media (max-width: 767px) { /* Mobile: header spans full width */
        .content-header {
            left: 0;
        }
    }
    .header-left-content { display: flex; align-items: center; }
    #currentSectionTitle {
        font-size: 1.5rem;
        font-weight: bold;
        margin: 0;
    }
    #breadcrumbs {
        font-size: 0.875rem;
        color: var(--text-color-muted);
        margin-top: 0.25rem;
    }
    #breadcrumbs a { color: var(--primary-color); text-decoration: none; }
    #breadcrumbs a:hover { text-decoration: underline; }

    .header-right-content { display: flex; align-items: center; gap: 1rem; }
    
    /* NEW: Admin Toolbar */
    .admin-toolbar {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background-color: var(--bg-color-alt);
        padding: 0.5rem;
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
    }
    .admin-toolbar a {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-color-muted);
        text-decoration: none;
        border-radius: var(--border-radius);
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .admin-toolbar a:hover {
        background-color: var(--bg-color-hover);
        color: var(--text-color);
    }
    .admin-toolbar a.active {
        background-color: var(--primary-color);
        color: var(--text-color-inverted);
    }

    .search-container { position: relative; }
    .search-container input[type="search"] {
        padding: 0.625rem 1rem 0.625rem 2.5rem; /* py-2.5 pl-10 pr-4 for LTR */
        border: 1px solid var(--border-color-darker);
        border-radius: 9999px;
        min-width: 250px;
        background-color: var(--bg-color-alt);
        color: var(--text-color);
    }
    .search-container input[type="search"]::placeholder {
        color: var(--text-color-muted);
        opacity: 0.8;
    }
    .search-container .search-icon {
        position: absolute;
        inset-inline-start: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-color-muted);
    }
    #searchResultsContainer {
        position: absolute;
        background-color: var(--bg-color-alt);
        border: 1px solid var(--border-color);
        border-top: none;
        width: 100%;
        max-height: 300px;
        overflow-y: auto;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        z-index: 60;
        border-radius: 0 0 var(--border-radius) var(--border-radius);
    }
    #searchResultsContainer a {
        display: block;
        padding: 0.75rem;
        text-decoration: none;
        color: var(--text-color);
    }
    #searchResultsContainer a:hover { background-color: var(--bg-color-hover); }
    #searchResultsContainer mark { background-color: #78350f; color: #f3f4f6; }

    .user-profile { display: flex; align-items: center; gap: 0.5rem; }
    #userAvatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: var(--primary-color);
        color: var(--text-color-inverted);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9rem;
    }
    #userNameDisplayHeader { font-weight: 500; }
    @media (max-width: 640px) {
        #userNameDisplayHeader { display: none; }
    }

    main { padding: 1.5rem 0; }

    main#pageContentArea.is-dashboard {
        padding: 0 !important;
    }
    
    .card {
        background-color: var(--bg-color-alt);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--card-shadow);
        transition: transform 0.2s ease, box-shadow 0.2s ease, background-color: 0.3s ease, border-color: 0.3s ease;
        display: flex;
        flex-direction: column;
        min-height: 150px;
    }
    .card:hover {
        transform: translateY(-4px);
        box-shadow: var(--card-hover-shadow);
    }
    .card-header-icon {
        display: flex;
        align-items: center;
        margin-bottom: 0.75rem;
    }
    .card-icon-container {
        padding: 0.75rem;
        border-radius: 50%;
        margin-right: 1rem; /* LTR */
        background-color: var(--primary-color-hover);
    }
    .card-icon-container i {
        font-size: 1.25rem;
        color: var(--text-color-inverted);
    }
    .card-title-group {
        flex-grow: 1;
    }
    .card h3 { margin-top: 0; font-size: 1.125rem; font-weight: 600; color: var(--text-color); line-height: 1.3; }
    .card p { margin-bottom: 1rem; font-size: 0.875rem; color: var(--text-color-subtle); flex-grow: 1; }
    
    .updated-badge {
        display: inline-block;
        background-color: rgba(34, 197, 94, 0.15); /* Green with transparency */
        border: 1px solid rgba(34, 197, 94, 0.4);
        color: #22c55e;
        padding: 0.15rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.65rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        margin-top: 0.4rem;
    }
    .card-tags {
        margin-top: 0rem;
        margin-bottom: 0.75rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    .card-tags .tag {
        background-color: var(--bg-color);
        border: 1px solid var(--border-color);
        color: var(--text-color-muted);
        padding: 0.2rem 0.6rem;
        border-radius: 9999px;
        font-size: 0.7rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.02em;
    }

    .card-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
        margin-top: auto;
    }
    .card-actions .button {
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
    }

    .button, button {
        background-color: var(--primary-color);
        color: var(--text-color-inverted);
        border: 1px solid transparent;
        padding: 0.625rem 1rem;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 0.875rem;
        font-weight: 500;
        transition: background-color: 0.2s, border-color: 0.2s, color: 0.2s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    .button:hover, button:hover {
        background-color: var(--primary-color-hover);
    }
    .button-secondary {
        background-color: transparent;
        color: var(--text-color-subtle);
        border-color: var(--border-color-darker);
    }
    .button-secondary:hover { background-color: var(--bg-color-hover); color: var(--text-color); }
    .button-danger {
        background-color: #dc2626;
        color: var(--text-color-inverted);
    }
    .button-danger:hover { background-color: #b91c1c; }
    input:focus, button:focus, select:focus, textarea:focus, a:focus {
        outline: 2px solid transparent;
        outline-offset: 2px;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.6);
    }
    button:disabled {
        background-color: var(--border-color);
        color: var(--text-color-muted);
        cursor: not-allowed;
        border-color: transparent;
    }

    .modal-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0,0,0,0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.2s ease-out;
    }
    .modal-overlay:not(.hidden) { opacity: 1; }
    .modal-content {
        background-color: var(--bg-color-modal);
        padding: 1.5rem;
        border-radius: var(--border-radius-lg);
        box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        width: 100%;
        max-width: 48rem;
        max-height: 90vh;
        overflow-y: auto;
        transform: scale(0.95);
        opacity: 0;
        transition: transform 0.2s ease-out, opacity 0.2s ease-out, background-color: 0.3s ease, border-color: 0.3s ease;
    }
    .modal-overlay:not(.hidden) .modal-content { transform: scale(1); opacity: 1; }
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    .modal-header h2 { margin-top: 0; font-size: 1.5rem; font-weight: 700; }
    .modal-header .close-button {
        background: none; border: none; font-size: 1.5rem; color: var(--text-color-muted); cursor: pointer;
        padding: 0.25rem; line-height: 1; border-radius: 50%;
    }
    .modal-header .close-button:hover { background-color: var(--bg-color-hover); }
    
    .modal-body {
        padding-bottom: 1rem;
        font-size: 1rem;
        color: var(--text-color);
    }

    .modal-actions {
        margin-top: 1.5rem;
        text-align: left; /* LTR */
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: flex-end; /* LTR */
        gap: 0.75rem;
    }
     .modal-actions.no-border {
        border-top: none;
        padding-top: 0;
    }

    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; margin-bottom: 0.25rem; font-weight: 500; font-size: 0.875rem; }
    .form-group input[type="text"],
    .form-group input[type="url"],
    .form-group input[type="email"],
    .form-group input[type="file"],
    .form-group input[type="date"],
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 0.625rem;
        border: 1px solid var(--border-color-darker);
        border-radius: var(--border-radius);
        box-sizing: border-box;
        background-color: var(--bg-color);
        color: var(--text-color);
    }
    .form-group textarea { min-height: 100px; }
    
    .form-group input::placeholder,
    .form-group textarea::placeholder {
        color: var(--text-color-muted);
        opacity: 0.8;
    }
    
    #templateSelectionContainer { margin-bottom: 1.5rem; }
    #templateSelectionContainer h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-color); }
    .template-buttons-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
    .template-button {
        background-color: var(--bg-color);
        border: 1px solid var(--border-color-darker);
        color: var(--text-color-subtle);
        padding: 1rem;
        border-radius: var(--border-radius);
        text-align: left;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }
    .template-button:hover {
        border-color: var(--primary-color);
        background-color: var(--bg-color-hover);
        color: var(--text-color);
    }
    .template-button i {
        font-size: 1.5rem;
        margin-bottom: 0.75rem;
        display: block;
        color: var(--primary-color);
        width: 100%;
        text-align: left;
    }
    .template-button h4 {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    .template-button p {
        font-size: 0.8rem;
        line-height: 1.4;
        color: var(--text-color-muted);
    }

    .ql-toolbar {
        background: var(--bg-color);
        border-color: var(--border-color-darker) !important;
        border-top-left-radius: var(--border-radius);
        border-top-right-radius: var(--border-radius);
    }
    .ql-toolbar .ql-stroke { stroke: var(--text-color-muted); }
    .ql-toolbar .ql-fill { fill: var(--text-color-muted); }
    .ql-toolbar .ql-picker-label { color: var(--text-color-muted); }
    .ql-snow .ql-picker.ql-expanded .ql-picker-options { background-color: var(--bg-color-alt); border-color: var(--border-color-darker); }
    .ql-snow .ql-picker-options .ql-picker-item:hover { color: var(--primary-color); }

    .ql-toolbar .ql-html::after {
        content: '</>';
        font-weight: bold;
        font-family: monospace;
        font-size: 14px;
    }

    .ql-container {
        background: var(--bg-color-alt);
        border-color: var(--border-color-darker) !important;
        color: var(--text-color);
        min-height: 250px;
        border-bottom-left-radius: var(--border-radius);
        border-bottom-right-radius: var(--border-radius);
        font-size: 1rem;
    }
    .ql-editor { padding: 12px; }
    .ql-editor.ql-blank::before {
        color: var(--text-color-muted);
        opacity: 0.6;
    }

    footer {
        text-align: center;
        padding: 1.5rem;
        font-size: 0.875rem;
        color: var(--text-color-muted);
        border-top: 1px solid var(--border-color);
        margin-top: auto;
    }

    .mobile-sidebar-toggle {
        display: block;
        position: fixed;
        top: calc((var(--header-height) - 40px) / 2);
        left: 1.5rem; /* LTR */
        z-index: 101;
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.5rem 0.75rem;
        border-radius: var(--border-radius);
        font-size: 1.25rem;
        line-height: 1;
    }
    @media (min-width: 768px) {
        .mobile-sidebar-toggle { display: none; }
        .header-left-content #currentSectionTitle { margin-left: 0; }
    }
    @media (max-width: 767px) {
        .header-left-content #currentSectionTitle { margin-left: 0.5rem; }
        .content-header { padding: 1rem; }
        .header-right-content .search-container { display:none; }
        .admin-toolbar { display: none; } /* Hide admin toolbar on mobile */
    }

    .toast-notification {
        position: fixed;
        bottom: 20px;
        right: 20px; /* LTR */
        padding: 12px 18px;
        border-radius: var(--border-radius);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 2000;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.3s ease, transform 0.3s ease;
        display: flex;
        align-items: center;
        background-color: var(--bg-color-alt);
        color: var(--text-color);
        border: 1px solid var(--border-color);
    }
    .toast-notification.show { opacity: 1; transform: translateY(0); }
    .toast-icon { margin-right: 10px; /* LTR */ font-size: 1.2em; }
    .toast-success { background-color: #10b981; color: white; border-color: #059669; }
    .toast-error { background-color: #ef4444; color: white; border-color: #dc2626; }
    .toast-info { background-color: #3b82f6; color: white; border-color: #2563eb; }

    .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    /* --- Global styles for content injected via innerHTML --- */
    .kb-content h1, .kb-content h2, .kb-content h3 { margin-top: 1.5em; margin-bottom: 0.5em; color: var(--text-color); }
    .kb-content p { margin-bottom: 1em; line-height: 1.6; }
    .kb-content ul, .kb-content ol { margin-bottom: 1em; padding-left: 20px; /* LTR */ }
    .kb-content li { margin-bottom: 0.5em; }
    .kb-content strong { font-weight: bold; }
    .kb-content em { font-style: italic; }
    .kb-content a { color: var(--primary-color); text-decoration: underline; }
    .kb-content a.spotlight img { transition: transform 0.2s ease; }
    .kb-content a.spotlight:hover img { transform: scale(1.03); }
    .kb-content pre {
        background-color: var(--bg-color);
        padding: 10px;
        border-radius: var(--border-radius);
        overflow-x: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        position: relative;
    }
    .kb-content img, .ql-editor img {
        display: block;
        margin: 1rem 0;
        max-width: 100%;
        height: auto;
        border-radius: var(--border-radius);
    }
    .kb-content code {
        background-color: var(--bg-color-hover);
        padding: 0.2em 0.4em;
        margin: 0;
        font-size: 85%;
        border-radius: 3px;
    }
    .kb-content blockquote {
        background-color: var(--bg-color-hover);
        padding: 0.75rem 1rem;
        border-radius: var(--border-radius);
        margin: 1em 0;
        border-left: 4px solid var(--primary-color);
        color: var(--text-color);
        position: relative;
    }
    .kb-content blockquote i.fa-comment-dots {
        margin-right: 0.5rem;
        color: var(--primary-color);
    }
    .kb-content mark {
        padding: 0.1em 0.2em; border-radius: 0.2em; font-weight: bold;
        background-color: #78350f; color: #f3f4f6;
    }
    /* Arabic font support for content */
    .kb-content [lang='ar'] h1, .kb-content [lang='ar'] h2, .kb-content [lang='ar'] h3, .kb-content [lang='ar'] p {
        font-family: 'Cairo', sans-serif;
    }

    /* ========== أنماط الداشبورد ========== */
    .dashboard-grid {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: 1fr;
        padding: 1.5rem;
    }
    @media(min-width: 640px) {
        .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media(min-width: 1024px) {
        .dashboard-grid { grid-template-columns: repeat(4, 1fr); }
    }
    @media(min-width: 1280px) { /* Added for better spacing on large screens */
         .dashboard-grid { grid-template-columns: repeat(5, 1fr); }
    }

    .dashboard-grid .grid-col-span-2 { grid-column: span 1; }
    @media(min-width: 1024px) { .dashboard-grid .grid-col-span-2 { grid-column: span 2; } }
    .dashboard-grid .grid-col-span-4 { grid-column: span 1; }
    @media(min-width: 1024px) { .dashboard-grid .grid-col-span-4 { grid-column: span 4; } }
    .dashboard-grid .grid-col-span-5 { grid-column: span 1; }
    @media(min-width: 1280px) { .dashboard-grid .grid-col-span-5 { grid-column: span 5; } }

    .dashboard-stat-card {
        background-color: var(--bg-color-alt);
        border: 1px solid var(--border-color);
        padding: 1rem;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--card-shadow);
        display: flex;
        align-items: center;
        gap: 1rem;
        position: relative;
    }
    .dashboard-stat-card .icon-container {
        font-size: 1.5rem;
        color: var(--primary-color);
        background-color: var(--bg-color);
        height: 44px;
        width: 44px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    .dashboard-stat-card .stat-content { flex-grow: 1; }
    .dashboard-stat-card .stat-title {
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-color-muted);
        margin-bottom: 0.25rem;
    }
    .dashboard-stat-card .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-color);
        line-height: 1;
    }
    .dashboard-stat-card .stat-change {
        font-size: 0.7rem;
        font-weight: 500;
        margin-top: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    .stat-change.positive { color: var(--yes-color); }
    .stat-change.negative { color: var(--no-color); }

    .dashboard-chart-container {
        background-color: var(--bg-color-alt);
        border: 1px solid var(--border-color);
        padding: 1.5rem;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--card-shadow);
        min-height: 300px;
    }
    .dashboard-chart-container h3 {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-color);
    }

    /* ========== أنماط الجداول ========== */
    .table-container {
        background-color: var(--bg-color-alt);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        box-shadow: var(--card-shadow);
    }
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.875rem;
    }
    table thead {
        background-color: var(--bg-color);
        border-bottom: 2px solid var(--border-color);
    }
    table th {
        padding: 0.75rem 1rem;
        text-align: left;
        font-weight: 600;
        color: var(--text-color);
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    table td {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-color);
    }
    table tbody tr:hover {
        background-color: var(--bg-color-hover);
    }
    table tbody tr:last-child td {
        border-bottom: none;
    }

    /* ========== أنماط الصفحات المختلفة ========== */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    .section-header h2 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-color);
        margin: 0;
    }
    .section-actions {
        display: flex;
        gap: 0.75rem;
    }

    /* ========== أنماط إضافية ========== */
    .empty-state {
        text-align: center;
        padding: 2rem;
        color: var(--text-color-muted);
    }
    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--border-color);
    }
    .empty-state h3 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: var(--text-color);
    }
    .empty-state p {
        margin-bottom: 1.5rem;
    }

    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 1.5rem;
        gap: 0.5rem;
    }
    .pagination button {
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--border-color);
        background-color: var(--bg-color-alt);
        color: var(--text-color);
        border-radius: var(--border-radius);
        cursor: pointer;
    }
    .pagination button:hover {
        background-color: var(--bg-color-hover);
    }
    .pagination button.active {
        background-color: var(--primary-color);
        color: var(--text-color-inverted);
        border-color: var(--primary-color);
    }
    .pagination button:disabled {
        background-color: var(--bg-color);
        color: var(--text-color-muted);
        cursor: not-allowed;
    }

    /* ========== أنماط متجاوبة إضافية ========== */
    @media (max-width: 640px) {
        .dashboard-grid { padding: 1rem; }
        .dashboard-stat-card { flex-direction: column; text-align: center; }
        .dashboard-stat-card .icon-container { margin-bottom: 0.5rem; }
        .section-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
        .section-actions { width: 100%; justify-content: flex-end; }
        .table-container { overflow-x: auto; }
        table { min-width: 600px; }
    }

    /* ========== أنماط خاصة بالنسخة العربية ========== */
    [dir="rtl"] .sidebar {
        left: auto;
        right: 0;
        border-right: none;
        border-left: 1px solid var(--border-color);
    }
    [dir="rtl"] .sidebar.closed {
        transform: translateX(100%);
    }
    [dir="rtl"] .content-wrapper {
        margin-left: 0;
        margin-right: var(--sidebar-width);
    }
    [dir="rtl"] .sidebar-link i {
        margin-right: 0;
        margin-left: 0.75rem;
    }
    [dir="rtl"] .card-icon-container {
        margin-right: 0;
        margin-left: 1rem;
    }
    [dir="rtl"] .search-container .search-icon {
        inset-inline-start: auto;
        inset-inline-end: 0.75rem;
    }
    [dir="rtl"] .search-container input[type="search"] {
        padding: 0.625rem 2.5rem 0.625rem 1rem;
    }
    [dir="rtl"] .mobile-sidebar-toggle {
        left: auto;
        right: 1.5rem;
    }
    [dir="rtl"] .toast-notification {
        right: auto;
        left: 20px;
    }
    [dir="rtl"] .toast-icon {
        margin-right: 0;
        margin-left: 10px;
    }
    [dir="rtl"] .modal-actions {
        text-align: right;
        justify-content: flex-start;
    }
    [dir="rtl"] .kb-content ul, [dir="rtl"] .kb-content ol {
        padding-left: 0;
        padding-right: 20px;
    }
    [dir="rtl"] .kb-content blockquote {
        border-left: none;
        border-right: 4px solid var(--primary-color);
    }
    [dir="rtl"] .kb-content blockquote i.fa-comment-dots {
        margin-right: 0;
        margin-left: 0.5rem;
    }
    [dir="rtl"] table th, [dir="rtl"] table td {
        text-align: right;
    }
</style>
</head>
<body>
    <!-- شاشة التحميل -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">جاري تحميل البيانات...</div>
    </div>

    <!-- الشريط الجانبي -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-infinity" style="color: var(--primary-color); margin-right: 12px;"></i>
            <span class="sidebar-logo-text">InfiniBase</span>
        </div>
        
        <nav class="sidebar-nav" id="sidebarNav">
            <!-- سيتم ملء الروابط ديناميكياً -->
        </nav>
        
        <div class="sidebar-footer">
            <button id="toggleSidebar" class="button button-secondary">
                <i class="fas fa-chevron-left"></i> إغلاق الشريط الجانبي
            </button>
        </div>
    </aside>

    <!-- زر فتح الشريط الجانبي على الهاتف -->
    <button class="mobile-sidebar-toggle" id="mobileSidebarToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- المحتوى الرئيسي -->
    <div class="content-wrapper">
        <!-- رأس الصفحة -->
        <header class="content-header">
            <div class="header-left-content">
                <div>
                    <h1 id="currentSectionTitle">لوحة التحكم</h1>
                    <div id="breadcrumbs">
                        <a href="#">الرئيسية</a> / <span>لوحة التحكم</span>
                    </div>
                </div>
            </div>
            
            <div class="header-right-content">
                <!-- شريط أدوات المدير -->
                <div class="admin-toolbar">
                    <a href="#" class="active"><i class="fas fa-cog"></i> الإعدادات</a>
                    <a href="#"><i class="fas fa-users"></i> المستخدمين</a>
                    <a href="#"><i class="fas fa-chart-bar"></i> التقارير</a>
                    <a href="#"><i class="fas fa-database"></i> النسخ الاحتياطي</a>
                </div>
                
                <!-- شريط البحث -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="search" id="searchInput" placeholder="ابحث في قاعدة المعرفة...">
                    <div id="searchResultsContainer" class="hidden"></div>
                </div>
                
                <!-- ملف المستخدم الشخصي -->
                <div class="user-profile">
                    <div id="userAvatar">م</div>
                    <span id="userNameDisplayHeader">مدير النظام</span>
                </div>
            </div>
        </header>

        <!-- المحتوى الرئيسي -->
        <main id="pageContentArea">
            <!-- سيتم ملء المحتوى ديناميكياً -->
        </main>
    </div>

    <!-- النوافذ المنبثقة -->
    <!-- نافذة إضافة قسم جديد -->
    <div id="addSectionModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إضافة قسم جديد</h2>
                <button class="close-button" data-modal="addSectionModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addSectionForm">
                    <div class="form-group">
                        <label for="sectionName">اسم القسم</label>
                        <input type="text" id="sectionName" required>
                    </div>
                    <div class="form-group">
                        <label for="sectionDescription">وصف القسم</label>
                        <textarea id="sectionDescription"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="sectionIcon">أيقونة القسم</label>
                        <select id="sectionIcon">
                            <option value="fas fa-folder">مجلد</option>
                            <option value="fas fa-book">كتاب</option>
                            <option value="fas fa-file-alt">ملف</option>
                            <option value="fas fa-chart-bar">إحصائيات</option>
                            <option value="fas fa-cog">إعدادات</option>
                            <option value="fas fa-users">مستخدمين</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="button button-secondary" data-modal="addSectionModal">إلغاء</button>
                <button class="button" id="saveSectionBtn">حفظ</button>
            </div>
        </div>
    </div>

    <!-- نافذة إضافة مقال جديد -->
    <div id="addArticleModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إضافة مقال جديد</h2>
                <button class="close-button" data-modal="addArticleModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addArticleForm">
                    <div class="form-group">
                        <label for="articleTitle">عنوان المقال</label>
                        <input type="text" id="articleTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="articleSection">القسم</label>
                        <select id="articleSection" required>
                            <!-- سيتم ملء الأقسام ديناميكياً -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="articleTags">الكلمات المفتاحية (مفصولة بفاصلة)</label>
                        <input type="text" id="articleTags">
                    </div>
                    <div class="form-group">
                        <label for="articleContent">محتوى المقال</label>
                        <div id="articleContentEditor"></div>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="button button-secondary" data-modal="addArticleModal">إلغاء</button>
                <button class="button" id="saveArticleBtn">حفظ</button>
            </div>
        </div>
    </div>

    <!-- نافذة تأكيد الحذف -->
    <div id="deleteConfirmModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>تأكيد الحذف</h2>
                <button class="close-button" data-modal="deleteConfirmModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>هل أنت متأكد من رغبتك في حذف هذا العنصر؟ هذا الإجراء لا يمكن التراجع عنه.</p>
            </div>
            <div class="modal-actions">
                <button class="button button-secondary" data-modal="deleteConfirmModal">إلغاء</button>
                <button class="button button-danger" id="confirmDeleteBtn">حذف</button>
            </div>
        </div>
    </div>

    <!-- نافذة عرض المقال -->
    <div id="viewArticleModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="viewArticleTitle">عنوان المقال</h2>
                <button class="close-button" data-modal="viewArticleModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="article-meta" style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                    <span id="viewArticleSection" style="color: var(--primary-color); font-weight: 500;"></span>
                    <span style="margin: 0 0.5rem;">•</span>
                    <span id="viewArticleDate" style="color: var(--text-color-muted);"></span>
                    <span style="margin: 0 0.5rem;">•</span>
                    <span id="viewArticleTags" style="color: var(--text-color-muted);"></span>
                </div>
                <div id="viewArticleContent" class="kb-content">
                    <!-- سيتم ملء محتوى المقال هنا -->
                </div>
            </div>
            <div class="modal-actions no-border">
                <button class="button button-secondary" data-modal="viewArticleModal">إغلاق</button>
                <button class="button" id="editArticleBtn">تعديل</button>
                <button class="button button-danger" id="deleteArticleBtn">حذف</button>
            </div>
        </div>
    </div>

    <!-- نافذة الإعدادات -->
    <div id="settingsModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إعدادات النظام</h2>
                <button class="close-button" data-modal="settingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="settingsForm">
                    <div class="form-group">
                        <label for="systemName">اسم النظام</label>
                        <input type="text" id="systemName" value="InfiniBase">
                    </div>
                    <div class="form-group">
                        <label for="systemLogo">شعار النظام</label>
                        <input type="file" id="systemLogo">
                    </div>
                    <div class="form-group">
                        <label for="defaultLanguage">اللغة الافتراضية</label>
                        <select id="defaultLanguage">
                            <option value="ar">العربية</option>
                            <option value="en">الإنجليزية</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="backupFrequency">تكرار النسخ الاحتياطي</label>
                        <select id="backupFrequency">
                            <option value="daily">يومي</option>
                            <option value="weekly">أسبوعي</option>
                            <option value="monthly">شهري</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="button button-secondary" data-modal="settingsModal">إلغاء</button>
                <button class="button" id="saveSettingsBtn">حفظ الإعدادات</button>
            </div>
        </div>
    </div>

    <!-- إشعارات التطبيق -->
    <div id="toastNotification" class="toast-notification hidden">
        <i class="toast-icon"></i>
        <span class="toast-message"></span>
    </div>

    <!-- كود Supabase المدمج مباشرة في الصفحة -->
    <script>
        // ========== تهيئة Supabase ==========
        const SUPABASE_URL = 'https://aefiigottnlcmjzilqnh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFlZmlpZ290dG5sY21qemlscW5oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxNzY2MDQsImV4cCI6MjA2Mjc1MjYwNH0.FypB02v3tGMnxXV9ZmZMdMC0oQpREKOJWgHMPxUzwX4';
        
        // تهيئة عميل Supabase
        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // ========== المتغيرات العامة ==========
        let currentUser = null;
        let sections = [];
        let articles = [];
        let currentSectionId = null;
        let currentArticleId = null;
        let editor = null;

        // ========== تهيئة التطبيق ==========
        document.addEventListener('DOMContentLoaded', async function() {
            // تهيئة المحرر
            initializeEditor();
            
            // تحميل البيانات الأساسية
            await loadInitialData();
            
            // إعداد معالجات الأحداث
            setupEventListeners();
            
            // إخفاء شاشة التحميل
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingOverlay').classList.add('hidden');
                }, 500);
            }, 1000);
        });

        // ========== وظائف التهيئة ==========
        
        // تهيئة محرر النصوص
        function initializeEditor() {
            const toolbarOptions = [
                [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                [{ 'script': 'sub'}, { 'script': 'super' }],
                [{ 'indent': '-1'}, { 'indent': '+1' }],
                [{ 'color': [] }, { 'background': [] }],
                [{ 'align': [] }],
                ['blockquote', 'code-block'],
                ['link', 'image', 'video'],
                ['clean']
            ];
            
            editor = new Quill('#articleContentEditor', {
                modules: {
                    toolbar: toolbarOptions
                },
                theme: 'snow'
            });
        }
        
        // تحميل البيانات الأولية
        async function loadInitialData() {
            try {
                // جلب بيانات المستخدم
                const { data: { user }, error: userError } = await supabase.auth.getUser();
                if (userError) throw userError;
                
                currentUser = user;
                document.getElementById('userAvatar').textContent = user.email ? user.email.charAt(0).toUpperCase() : 'م';
                document.getElementById('userNameDisplayHeader').textContent = user.email || 'مدير النظام';
                
                // جلب الأقسام
                const { data: sectionsData, error: sectionsError } = await supabase
                    .from('sections')
                    .select('*')
                    .order('created_at', { ascending: true });
                    
                if (sectionsError) throw sectionsError;
                sections = sectionsData || [];
                
                // جلب المقالات
                const { data: articlesData, error: articlesError } = await supabase
                    .from('articles')
                    .select('*')
                    .order('created_at', { ascending: false });
                    
                if (articlesError) throw articlesError;
                articles = articlesData || [];
                
                // تحديث واجهة المستخدم
                updateSidebar();
                showDashboard();
                populateSectionDropdown();
                
            } catch (error) {
                console.error('خطأ في تحميل البيانات:', error);
                showToast('حدث خطأ في تحميل البيانات', 'error');
            }
        }
        
        // إعداد معالجات الأحداث
        function setupEventListeners() {
            // الشريط الجانبي
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
            document.getElementById('mobileSidebarToggle').addEventListener('click', toggleSidebar);
            
            // البحث
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // النوافذ المنبثقة
            document.querySelectorAll('.close-button').forEach(button => {
                button.addEventListener('click', function() {
                    const modalId = this.getAttribute('data-modal');
                    hideModal(modalId);
                });
            });
            
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideModal(this.id);
                    }
                });
            });
            
            // الأزرار
            document.getElementById('saveSectionBtn').addEventListener('click', saveSection);
            document.getElementById('saveArticleBtn').addEventListener('click', saveArticle);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            document.getElementById('editArticleBtn').addEventListener('click', editArticle);
            document.getElementById('deleteArticleBtn').addEventListener('click', deleteArticle);
            
            // إضافة مقال جديد من الداشبورد
            document.addEventListener('click', function(e) {
                if (e.target && e.target.id === 'addArticleBtn') {
                    showModal('addArticleModal');
                }
                
                if (e.target && e.target.id === 'addSectionBtn') {
                    showModal('addSectionModal');
                }
                
                if (e.target && e.target.classList.contains('view-article-btn')) {
                    const articleId = e.target.getAttribute('data-article-id');
                    viewArticle(articleId);
                }
                
                if (e.target && e.target.classList.contains('delete-item-btn')) {
                    const itemId = e.target.getAttribute('data-item-id');
                    const itemType = e.target.getAttribute('data-item-type');
                    showDeleteConfirm(itemId, itemType);
                }
            });
        }
        
        // ========== وظائف الشريط الجانبي ==========
        
        // تبديل الشريط الجانبي
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('closed');
            
            const toggleButton = document.getElementById('toggleSidebar');
            const icon = toggleButton.querySelector('i');
            
            if (sidebar.classList.contains('closed')) {
                toggleButton.innerHTML = '<i class="fas fa-chevron-right"></i> فتح الشريط الجانبي';
            } else {
                toggleButton.innerHTML = '<i class="fas fa-chevron-left"></i> إغلاق الشريط الجانبي';
            }
        }
        
        // تحديث الشريط الجانبي
        function updateSidebar() {
            const sidebarNav = document.getElementById('sidebarNav');
            let html = '';
            
            // قسم لوحة التحكم
            html += `
                <div class="sidebar-section-title">الرئيسية</div>
                <a href="#" class="sidebar-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>لوحة التحكم</span>
                </a>
            `;
            
            // قسم إدارة المحتوى
            if (sections.length > 0) {
                html += `<div class="sidebar-section-title">إدارة المحتوى</div>`;
                
                sections.forEach(section => {
                    html += `
                        <a href="#" class="sidebar-link" data-section="${section.id}">
                            <i class="${section.icon || 'fas fa-folder'}"></i>
                            <span>${section.name}</span>
                        </a>
                    `;
                });
            }
            
            // قسم الإدارة
            html += `
                <div class="sidebar-section-title">الإدارة</div>
                <a href="#" class="sidebar-link" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>إدارة المستخدمين</span>
                </a>
                <a href="#" class="sidebar-link" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>التقارير والإحصائيات</span>
                </a>
                <a href="#" class="sidebar-link" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>إعدادات النظام</span>
                </a>
            `;
            
            sidebarNav.innerHTML = html;
            
            // إضافة معالجات الأحداث للروابط
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // إزالة النشاط من جميع الروابط
                    document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                    
                    // إضافة النشاط للرابط الحالي
                    this.classList.add('active');
                    
                    // تحميل المحتوى المناسب
                    const sectionId = this.getAttribute('data-section');
                    
                    if (sectionId === 'dashboard') {
                        showDashboard();
                    } else if (sectionId === 'users') {
                        showUsers();
                    } else if (sectionId === 'reports') {
                        showReports();
                    } else if (sectionId === 'settings') {
                        showSettings();
                    } else {
                        showSection(sectionId);
                    }
                });
            });
        }
        
        // ========== وظائف عرض المحتوى ==========
        
        // عرض لوحة التحكم
        function showDashboard() {
            const pageContent = document.getElementById('pageContentArea');
            pageContent.className = 'is-dashboard';
            
            // حساب الإحصائيات
            const totalArticles = articles.length;
            const totalSections = sections.length;
            const recentArticles = articles.slice(0, 5);
            const popularArticles = [...articles].sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 5);
            
            let html = `
                <div class="dashboard-grid">
                    <!-- بطاقات الإحصائيات -->
                    <div class="dashboard-stat-card">
                        <div class="icon-container">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي المقالات</div>
                            <div class="stat-value">${totalArticles}</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> 12% منذ الشهر الماضي
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-stat-card">
                        <div class="icon-container">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">إجمالي الأقسام</div>
                            <div class="stat-value">${totalSections}</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> 5% منذ الشهر الماضي
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-stat-card">
                        <div class="icon-container">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">المشاهدات</div>
                            <div class="stat-value">${articles.reduce((sum, article) => sum + (article.views || 0), 0)}</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> 18% منذ الشهر الماضي
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-stat-card">
                        <div class="icon-container">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-title">المستخدمين النشطين</div>
                            <div class="stat-value">24</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> 8% منذ الشهر الماضي
                            </div>
                        </div>
                    </div>
                    
                    <!-- مخطط المقالات حسب الشهر -->
                    <div class="dashboard-chart-container grid-col-span-4">
                        <h3>المقالات المنشورة حسب الشهر</h3>
                        <canvas id="articlesChart"></canvas>
                    </div>
                    
                    <!-- المقالات الحديثة -->
                    <div class="card grid-col-span-2">
                        <div class="card-header-icon">
                            <div class="card-icon-container">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="card-title-group">
                                <h3>المقالات الحديثة</h3>
                                <p>أحدث المقالات المضافة إلى النظام</p>
                            </div>
                        </div>
                        <div class="card-tags">
                            <span class="tag">محدث</span>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>العنوان</th>
                                        <th>القسم</th>
                                        <th>التاريخ</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            recentArticles.forEach(article => {
                const section = sections.find(s => s.id === article.section_id) || { name: 'غير محدد' };
                const date = new Date(article.created_at).toLocaleDateString('ar-EG');
                
                html += `
                    <tr>
                        <td>${article.title}</td>
                        <td>${section.name}</td>
                        <td>${date}</td>
                        <td>
                            <button class="button button-secondary view-article-btn" data-article-id="${article.id}">عرض</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="card-actions">
                            <button class="button" id="addArticleBtn">
                                <i class="fas fa-plus"></i> إضافة مقال جديد
                            </button>
                        </div>
                    </div>
                    
                    <!-- المقالات الأكثر مشاهدة -->
                    <div class="card grid-col-span-2">
                        <div class="card-header-icon">
                            <div class="card-icon-container">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="card-title-group">
                                <h3>المقالات الأكثر مشاهدة</h3>
                                <p>المقالات التي حظيت بأكبر عدد من المشاهدات</p>
                            </div>
                        </div>
                        <div class="card-tags">
                            <span class="tag">شائع</span>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>العنوان</th>
                                        <th>المشاهدات</th>
                                        <th>التقييم</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            popularArticles.forEach(article => {
                html += `
                    <tr>
                        <td>${article.title}</td>
                        <td>${article.views || 0}</td>
                        <td>${article.rating || 'غير محدد'}</td>
                        <td>
                            <button class="button button-secondary view-article-btn" data-article-id="${article.id}">عرض</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = html;
            
            // تحديث عنوان الصفحة
            document.getElementById('currentSectionTitle').textContent = 'لوحة التحكم';
            document.getElementById('breadcrumbs').innerHTML = '<a href="#">الرئيسية</a> / <span>لوحة التحكم</span>';
            
            // رسم المخطط البياني
            renderArticlesChart();
        }
        
        // عرض قسم معين
        function showSection(sectionId) {
            const section = sections.find(s => s.id === sectionId);
            if (!section) return;
            
            const pageContent = document.getElementById('pageContentArea');
            pageContent.className = '';
            
            const sectionArticles = articles.filter(article => article.section_id === sectionId);
            
            let html = `
                <div class="section-header">
                    <h2>${section.name}</h2>
                    <div class="section-actions">
                        <button class="button" id="addArticleBtn">
                            <i class="fas fa-plus"></i> إضافة مقال
                        </button>
                        <button class="button button-secondary" id="editSectionBtn" data-section-id="${sectionId}">
                            <i class="fas fa-edit"></i> تعديل القسم
                        </button>
                    </div>
                </div>
                
                <p style="margin-bottom: 1.5rem; color: var(--text-color-muted);">${section.description || 'لا يوجد وصف للقسم'}</p>
            `;
            
            if (sectionArticles.length === 0) {
                html += `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>لا توجد مقالات في هذا القسم</h3>
                        <p>ابدأ بإضافة أول مقال إلى هذا القسم</p>
                        <button class="button" id="addArticleBtn">
                            <i class="fas fa-plus"></i> إضافة مقال جديد
                        </button>
                    </div>
                `;
            } else {
                html += `<div class="cards-grid">`;
                
                sectionArticles.forEach(article => {
                    const date = new Date(article.created_at).toLocaleDateString('ar-EG');
                    const tags = article.tags ? article.tags.split(',').slice(0, 3) : [];
                    
                    html += `
                        <div class="card">
                            <div class="card-header-icon">
                                <div class="card-icon-container">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="card-title-group">
                                    <h3>${article.title}</h3>
                                    <p>${article.summary || 'لا يوجد ملخص للمقال'}</p>
                                </div>
                            </div>
                            
                            <div class="updated-badge">تم التحديث ${date}</div>
                            
                            ${tags.length > 0 ? `
                                <div class="card-tags">
                                    ${tags.map(tag => `<span class="tag">${tag.trim()}</span>`).join('')}
                                </div>
                            ` : ''}
                            
                            <div class="card-actions">
                                <button class="button button-secondary view-article-btn" data-article-id="${article.id}">عرض</button>
                                <button class="button button-secondary" data-article-id="${article.id}">تعديل</button>
                                <button class="button button-danger delete-item-btn" data-item-id="${article.id}" data-item-type="article">حذف</button>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            pageContent.innerHTML = html;
            
            // تحديث عنوان الصفحة
            document.getElementById('currentSectionTitle').textContent = section.name;
            document.getElementById('breadcrumbs').innerHTML = `<a href="#" data-section="dashboard">الرئيسية</a> / <span>${section.name}</span>`;
            
            // إضافة معالجات الأحداث للأزرار
            document.getElementById('editSectionBtn').addEventListener('click', function() {
                // سيتم تنفيذ وظيفة تعديل القسم هنا
                showToast('سيتم تنفيذ وظيفة تعديل القسم في الإصدار القادم', 'info');
            });
        }
        
        // عرض إدارة المستخدمين
        function showUsers() {
            const pageContent = document.getElementById('pageContentArea');
            pageContent.className = '';
            
            let html = `
                <div class="section-header">
                    <h2>إدارة المستخدمين</h2>
                    <div class="section-actions">
                        <button class="button">
                            <i class="fas fa-plus"></i> إضافة مستخدم
                        </button>
                        <button class="button button-secondary">
                            <i class="fas fa-sync"></i> تحديث القائمة
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>اسم المستخدم</th>
                                <th>البريد الإلكتروني</th>
                                <th>الدور</th>
                                <th>الحالة</th>
                                <th>آخر نشاط</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>أحمد محمد</td>
                                <td>ahmed@example.com</td>
                                <td>مدير</td>
                                <td><span style="color: var(--yes-color);">نشط</span></td>
                                <td>2023-10-15</td>
                                <td>
                                    <button class="button button-secondary">تعديل</button>
                                    <button class="button button-danger">حذف</button>
                                </td>
                            </tr>
                            <tr>
                                <td>فاطمة علي</td>
                                <td>fatima@example.com</td>
                                <td>محرر</td>
                                <td><span style="color: var(--yes-color);">نشط</span></td>
                                <td>2023-10-14</td>
                                <td>
                                    <button class="button button-secondary">تعديل</button>
                                    <button class="button button-danger">حذف</button>
                                </td>
                            </tr>
                            <tr>
                                <td>خالد إبراهيم</td>
                                <td>khaled@example.com</td>
                                <td>قارئ</td>
                                <td><span style="color: var(--yes-color);">نشط</span></td>
                                <td>2023-10-13</td>
                                <td>
                                    <button class="button button-secondary">تعديل</button>
                                    <button class="button button-danger">حذف</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            pageContent.innerHTML = html;
            
            // تحديث عنوان الصفحة
            document.getElementById('currentSectionTitle').textContent = 'إدارة المستخدمين';
            document.getElementById('breadcrumbs').innerHTML = '<a href="#" data-section="dashboard">الرئيسية</a> / <span>إدارة المستخدمين</span>';
        }
        
        // عرض التقارير والإحصائيات
        function showReports() {
            const pageContent = document.getElementById('pageContentArea');
            pageContent.className = '';
            
            let html = `
                <div class="section-header">
                    <h2>التقارير والإحصائيات</h2>
                    <div class="section-actions">
                        <button class="button">
                            <i class="fas fa-download"></i> تصدير التقرير
                        </button>
                        <button class="button button-secondary">
                            <i class="fas fa-print"></i> طباعة
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-grid" style="grid-template-columns: 1fr;">
                    <div class="dashboard-chart-container">
                        <h3>توزيع المقالات على الأقسام</h3>
                        <canvas id="sectionsChart" height="300"></canvas>
                    </div>
                    
                    <div class="dashboard-chart-container">
                        <h3>نشاط المستخدمين</h3>
                        <canvas id="activityChart" height="300"></canvas>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = html;
            
            // تحديث عنوان الصفحة
            document.getElementById('currentSectionTitle').textContent = 'التقارير والإحصائيات';
            document.getElementById('breadcrumbs').innerHTML = '<a href="#" data-section="dashboard">الرئيسية</a> / <span>التقارير والإحصائيات</span>';
            
            // رسم المخططات البيانية
            renderSectionsChart();
            renderActivityChart();
        }
        
        // عرض إعدادات النظام
        function showSettings() {
            const pageContent = document.getElementById('pageContentArea');
            pageContent.className = '';
            
            let html = `
                <div class="section-header">
                    <h2>إعدادات النظام</h2>
                    <div class="section-actions">
                        <button class="button" id="openSettingsModal">
                            <i class="fas fa-cog"></i> فتح الإعدادات
                        </button>
                    </div>
                </div>
                
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header-icon">
                            <div class="card-icon-container">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="card-title-group">
                                <h3>الإعدادات العامة</h3>
                                <p>إعدادات اللغة والمنطقة الزمنية والعنوان</p>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="button button-secondary" id="openGeneralSettings">فتح</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header-icon">
                            <div class="card-icon-container">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="card-title-group">
                                <h3>الأمان والصلاحيات</h3>
                                <p>إعدادات المصادقة والصلاحيات والمستخدمين</p>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="button button-secondary" id="openSecuritySettings">فتح</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header-icon">
                            <div class="card-icon-container">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="card-title-group">
                                <h3>النسخ الاحتياطي</h3>
                                <p>إعدادات النسخ الاحتياطي والاستعادة</p>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="button button-secondary" id="openBackupSettings">فتح</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header-icon">
                            <div class="card-icon-container">
                                <i class="fas fa-paint-brush"></i>
                            </div>
                            <div class="card-title-group">
                                <h3>المظهر والتصميم</h3>
                                <p>تخصيص مظهر النظام والألوان</p>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="button button-secondary" id="openAppearanceSettings">فتح</button>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = html;
            
            // تحديث عنوان الصفحة
            document.getElementById('currentSectionTitle').textContent = 'إعدادات النظام';
            document.getElementById('breadcrumbs').innerHTML = '<a href="#" data-section="dashboard">الرئيسية</a> / <span>إعدادات النظام</span>';
            
            // إضافة معالجات الأحداث للأزرار
            document.getElementById('openSettingsModal').addEventListener('click', function() {
                showModal('settingsModal');
            });
        }
        
        // ========== وظائف النوافذ المنبثقة ==========
        
        // عرض نافذة منبثقة
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            
            // إضافة تأثير الظهور
            setTimeout(() => {
                modal.style.opacity = '1';
                const modalContent = modal.querySelector('.modal-content');
                modalContent.style.transform = 'scale(1)';
                modalContent.style.opacity = '1';
            }, 10);
        }
        
        // إخفاء نافذة منبثقة
        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.style.transform = 'scale(0.95)';
            modalContent.style.opacity = '0';
            modal.style.opacity = '0';
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }
        
        // ملء قائمة الأقسام في النافذة المنبثقة
        function populateSectionDropdown() {
            const dropdown = document.getElementById('articleSection');
            dropdown.innerHTML = '';
            
            sections.forEach(section => {
                const option = document.createElement('option');
                option.value = section.id;
                option.textContent = section.name;
                dropdown.appendChild(option);
            });
        }
        
        // عرض تأكيد الحذف
        function showDeleteConfirm(itemId, itemType) {
            currentArticleId = itemId;
            showModal('deleteConfirmModal');
        }
        
        // عرض مقال
        function viewArticle(articleId) {
            const article = articles.find(a => a.id === articleId);
            if (!article) return;
            
            const section = sections.find(s => s.id === article.section_id) || { name: 'غير محدد' };
            const date = new Date(article.created_at).toLocaleDateString('ar-EG');
            const tags = article.tags || 'لا توجد كلمات مفتاحية';
            
            document.getElementById('viewArticleTitle').textContent = article.title;
            document.getElementById('viewArticleSection').textContent = section.name;
            document.getElementById('viewArticleDate').textContent = date;
            document.getElementById('viewArticleTags').textContent = tags;
            document.getElementById('viewArticleContent').innerHTML = article.content || 'لا يوجد محتوى';
            
            currentArticleId = articleId;
            showModal('viewArticleModal');
        }
        
        // ========== وظائف CRUD ==========
        
        // حفظ قسم جديد
        async function saveSection() {
            const name = document.getElementById('sectionName').value;
            const description = document.getElementById('sectionDescription').value;
            const icon = document.getElementById('sectionIcon').value;
            
            if (!name) {
                showToast('يرجى إدخال اسم القسم', 'error');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('sections')
                    .insert([
                        { 
                            name, 
                            description, 
                            icon,
                            created_by: currentUser.id
                        }
                    ])
                    .select();
                    
                if (error) throw error;
                
                showToast('تم إضافة القسم بنجاح', 'success');
                hideModal('addSectionModal');
                
                // إعادة تحميل البيانات
                await loadInitialData();
                
            } catch (error) {
                console.error('خطأ في حفظ القسم:', error);
                showToast('حدث خطأ في حفظ القسم', 'error');
            }
        }
        
        // حفظ مقال جديد
        async function saveArticle() {
            const title = document.getElementById('articleTitle').value;
            const sectionId = document.getElementById('articleSection').value;
            const tags = document.getElementById('articleTags').value;
            const content = editor.root.innerHTML;
            
            if (!title || !sectionId) {
                showToast('يرجى إدخال العنوان واختيار القسم', 'error');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('articles')
                    .insert([
                        { 
                            title, 
                            section_id: sectionId,
                            tags,
                            content,
                            created_by: currentUser.id
                        }
                    ])
                    .select();
                    
                if (error) throw error;
                
                showToast('تم إضافة المقال بنجاح', 'success');
                hideModal('addArticleModal');
                
                // إعادة تحميل البيانات
                await loadInitialData();
                
            } catch (error) {
                console.error('خطأ في حفظ المقال:', error);
                showToast('حدث خطأ في حفظ المقال', 'error');
            }
        }
        
        // تأكيد الحذف
        async function confirmDelete() {
            if (!currentArticleId) return;
            
            try {
                const { error } = await supabase
                    .from('articles')
                    .delete()
                    .eq('id', currentArticleId);
                    
                if (error) throw error;
                
                showToast('تم حذف المقال بنجاح', 'success');
                hideModal('deleteConfirmModal');
                
                // إعادة تحميل البيانات
                await loadInitialData();
                
            } catch (error) {
                console.error('خطأ في حذف المقال:', error);
                showToast('حدث خطأ في حذف المقال', 'error');
            }
        }
        
        // حفظ الإعدادات
        async function saveSettings() {
            // في التطبيق الحقيقي، سيتم حفظ الإعدادات في قاعدة البيانات
            showToast('تم حفظ الإعدادات بنجاح', 'success');
            hideModal('settingsModal');
        }
        
        // تعديل مقال
        function editArticle() {
            // في التطبيق الحقيقي، سيتم فتح نافذة التعديل
            showToast('سيتم فتح نافذة التعديل في الإصدار القادم', 'info');
        }
        
        // حذف مقال
        function deleteArticle() {
            hideModal('viewArticleModal');
            showDeleteConfirm(currentArticleId, 'article');
        }
        
        // ========== وظائف البحث ==========
        
        // معالجة البحث
        function handleSearch(e) {
            const query = e.target.value.trim();
            const resultsContainer = document.getElementById('searchResultsContainer');
            
            if (query.length < 2) {
                resultsContainer.classList.add('hidden');
                return;
            }
            
            // البحث في المقالات
            const results = articles.filter(article => 
                article.title.toLowerCase().includes(query.toLowerCase()) ||
                (article.content && article.content.toLowerCase().includes(query.toLowerCase())) ||
                (article.tags && article.tags.toLowerCase().includes(query.toLowerCase()))
            );
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div style="padding: 0.75rem;">لا توجد نتائج</div>';
            } else {
                let html = '';
                results.slice(0, 5).forEach(article => {
                    const section = sections.find(s => s.id === article.section_id) || { name: 'غير محدد' };
                    
                    // تمييز النص المطابق
                    let title = article.title;
                    if (title.toLowerCase().includes(query.toLowerCase())) {
                        const start = title.toLowerCase().indexOf(query.toLowerCase());
                        const end = start + query.length;
                        title = title.substring(0, start) + 
                                '<mark>' + title.substring(start, end) + '</mark>' + 
                                title.substring(end);
                    }
                    
                    html += `
                        <a href="#" class="search-result" data-article-id="${article.id}">
                            <div style="font-weight: 500;">${title}</div>
                            <div style="font-size: 0.8rem; color: var(--text-color-muted);">${section.name}</div>
                        </a>
                    `;
                });
                
                resultsContainer.innerHTML = html;
                
                // إضافة معالجات الأحداث للنتائج
                document.querySelectorAll('.search-result').forEach(result => {
                    result.addEventListener('click', function(e) {
                        e.preventDefault();
                        const articleId = this.getAttribute('data-article-id');
                        viewArticle(articleId);
                        resultsContainer.classList.add('hidden');
                        document.getElementById('searchInput').value = '';
                    });
                });
            }
            
            resultsContainer.classList.remove('hidden');
        }
        
        // ========== وظائف المخططات البيانية ==========
        
        // رسم مخطط المقالات حسب الشهر
        function renderArticlesChart() {
            const ctx = document.getElementById('articlesChart').getContext('2d');
            
            // بيانات نموذجية
            const months = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
            const articlesData = [5, 7, 10, 8, 12, 15, 18, 16, 14, 12, 10, 8];
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'المقالات المنشورة',
                        data: articlesData,
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        }
                    }
                }
            });
        }
        
        // رسم مخطط توزيع المقالات على الأقسام
        function renderSectionsChart() {
            const ctx = document.getElementById('sectionsChart').getContext('2d');
            
            // تجميع المقالات حسب الأقسام
            const sectionCounts = {};
            sections.forEach(section => {
                sectionCounts[section.name] = articles.filter(article => article.section_id === section.id).length;
            });
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(sectionCounts),
                    datasets: [{
                        data: Object.values(sectionCounts),
                        backgroundColor: [
                            '#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
                            '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#14b8a6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#d1d5db',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }
        
        // رسم مخطط نشاط المستخدمين
        function renderActivityChart() {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            // بيانات نموذجية
            const days = ['السبت', 'الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة'];
            const activityData = [120, 150, 180, 200, 170, 140, 160];
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'نشاط المستخدمين',
                        data: activityData,
                        backgroundColor: 'rgba(99, 102, 241, 0.7)',
                        borderColor: '#6366f1',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#d1d5db'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        }
                    }
                }
            });
        }
        
        // ========== وظائف مساعدة ==========
        
        // عرض الإشعارات
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toastNotification');
            const toastIcon = toast.querySelector('.toast-icon');
            const toastMessage = toast.querySelector('.toast-message');
            
            // تعيين النص واللون حسب النوع
            toastMessage.textContent = message;
            toast.className = 'toast-notification';
            
            switch (type) {
                case 'success':
                    toast.classList.add('toast-success');
                    toastIcon.className = 'toast-icon fas fa-check-circle';
                    break;
                case 'error':
                    toast.classList.add('toast-error');
                    toastIcon.className = 'toast-icon fas fa-exclamation-circle';
                    break;
                case 'info':
                    toast.classList.add('toast-info');
                    toastIcon.className = 'toast-icon fas fa-info-circle';
                    break;
            }
            
            // إظهار الإشعار
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // إخفاء الإشعار بعد 5 ثوانٍ
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 300);
            }, 5000);
        }
    </script>

    <!-- مكتبة Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
